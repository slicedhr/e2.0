{"version":3,"sources":["productos/productos-form-directive.js"],"names":[],"mappings":";;AAAA,AAAC,CAAA,YAAY;AACX,cAAY,CAAC;;;;;;;;;;;;;;;;;;AAkBb,SAAO,CACJ,MAAM,CAAC,WAAW,CAAC,CACnB,SAAS,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC;;AAE7C,WAAS,aAAa,GAAG;AACvB,WAAO;AACL,cAAQ,EAAE,IAAI;AACd,WAAK,EAAE;AACL,YAAI,EAAE,GAAG;OACV;AACD,iBAAW,EAAE,6CAA6C;AAC1D,aAAO,EAAE,KAAK;AACd,kBAAY,EAAE,eAAe;AAC7B,gBAAU,EAAE,oBAAU,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,OAAO,EAAE;;AAE7D,YAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,YAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAG,CAAA;;AAE1C,YAAI,CAAC,IAAI,CAAC,cAAc,GAAG,EAAE,CAAA;;AAE7B,YAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;;AAErB,YAAI,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EACrD,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,EACpE,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,GAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,SAAS,CAAA,KAE3G,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAA;;AAG9B,YAAI,CAAC,oBAAoB,GAAG,YAAM;;AAEhC,cAAI,MAAM,GAAG;AACX,kBAAM,EAAE,KAAK;AACb,eAAG,EAAE,UAAU,CAAC,SAAS,CAAC,oCAAoC,CAAC;WAChE,CAAA;;AAED,oBAAU,CACP,IAAI,CAAC,MAAM,CAAC,CACZ,IAAI,CAAC,UAAA,OAAO,EAAI;;AAEb,gBAAI,CAAC,iBAAiB,GAAG,OAAO,CAAC,IAAI,CAAC,OAAO,CAAA;WAEhD,CAAC,CAAA;SAEL,CAAA;;AAED,YAAI,CAAC,oBAAoB,EAAE,CAAA;;AAE3B,YAAI,CAAC,WAAW,GAAG,CACjB;AACE,aAAG,EAAE,WAAW;AAChB,kBAAQ,EAAE,IAAI;AACd,eAAK,EAAE,WAAW;SACnB,EACD;AACE,aAAG,EAAE,OAAO;AACZ,kBAAQ,EAAE,IAAI;AACd,eAAK,EAAE,OAAO;SACf,EACD;AACE,aAAG,EAAE,kBAAkB;AACvB,kBAAQ,EAAE,IAAI;AACd,eAAK,EAAE,kBAAkB;SAC1B,EACD;AACE,aAAG,EAAE,WAAW;AAChB,kBAAQ,EAAE,IAAI;AACd,eAAK,EAAE,WAAW;SACnB,EACD;AACE,aAAG,EAAE,YAAY;AACjB,kBAAQ,EAAE,KAAK;AACf,eAAK,EAAE,aAAa;SACrB,CACF,CAAA;;AAED,YAAK,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;;AAEtC,eAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAC;;AAE/C,gBAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAE,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;;AAEjF,gBAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EACpC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAA;WAG7E;SACF;;AAED,YAAI,CAAC,MAAM,GAAG,WAAW,CAAA;;AAEzB,YAAI,CAAC,cAAc,GAAG,UAAC,IAAI,EAAE,KAAK,EAAK;;AAErC,cAAI,KAAK,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,gBAAgB,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;;AAGrF,cAAG,KAAK,EACN,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,GAAG,KAAK,CAAA,KAG3E,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;AACxB,qBAAS,EAAE,KAAK;AAChB,4BAAgB,EAAE,IAAI,CAAC,EAAE;WAC1B,CAAC,CAAA;SAEL,CAAA;;AAED,YAAI,CAAC,IAAI,GAAG,YAAM;;AAEhB,cAAI,IAAI,GAAG,IAAI,CAAC,IAAI;cAChB,GAAG,GAAG,IAAI,CAAC,MAAM,CAAA;;AAErB,eAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAC;;AAE/C,gBAAK,CAAC,IAAI,CAAC,IAAI,CAAE,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAE,IAAI,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE;;AAEjF,kBAAI,CAAC,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,CAAA;;AAE3C,qBAAM;aACT,MAEC,IAAI,CAAC,UAAU,GAAG,KAAK,CAAA;WAG1B;;AAED,oBAAU,CACP,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CACf,IAAI,CAAC,UAAA,OAAO,EAAI;;AAGf,gBAAI,IAAI,CAAC,IAAI,CAAC,EAAE,EAAC;;AAEd,wBAAU,CAAC,IAAI,CAAC;AACf,sBAAM,EAAC,KAAK;AACZ,oBAAI,EAAE;AACJ,4BAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU;iBACjC;AACD,mBAAG,EAAE,UAAU,CAAC,SAAS,CAAC,gCAAgC,CAAC;eAC5D,CAAC,CAAC,IAAI,CAAC,UAAA,UAAU,EAAI;;AAEpB,uBAAO,CAAC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,IAAI,CAAA;;AAEzC,oBAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAA;eAExB,CAAC,CAAA;aAEH,MACG;;AAEF,wBAAU,CAAC,IAAI,CAAC;AACd,sBAAM,EAAC,MAAM;AACb,oBAAI,EAAE;AACJ,4BAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU;AAChC,0BAAQ,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE;iBAC1B;AACD,mBAAG,EAAE,UAAU,CAAC,SAAS,CAAC,4BAA4B,CAAC;eACxD,CAAC,CAAC,IAAI,CAAC,UAAA,UAAU,EAAI;;AAEpB,uBAAO,CAAC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,IAAI,CAAA;;AAEzC,oBAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAA;eAGxB,CAAC,CAAA;aAEH;WAKF,CAAC,SACI,CAAC,UAAA,GAAG,EAAI;;AAEZ,sBAAU,CAAC,cAAc,CAAC,GAAG,CAAC,CAAA;WAE/B,CAAC,CAAA;SAEL,CAAA;;AAED,YAAI,CAAC,SAAS,GAAG,UAAA,OAAO,EAAI;;AAE1B,eAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAC9C,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAE,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;;AAE9E,cAAI,CAAC,IAAI,CAAC,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,CAAA;;AAE9B,oBAAU,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;;AAErC,oBAAU,CAAC,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAA;SAE/D,CAAA;;AAED,YAAI,CAAC,iBAAiB,GAAG,UAAC,KAAK,EAAE,IAAI,EAAK;;AAExC,cAAI,IAAI,EAEN,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,EAAE,CAAA,KAK1B,OAAO,KAAK,CAAA;SAEf,CAAA;;AAED,YAAI,CAAC,eAAe,GAAG,UAAC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAK;;AAE9C,cAAI,KAAK,GAAG,EAAE,CAAA;;AAEd,eAAK,CAAC,KAAK,CAAC,GAAG;;AAEb,oBAAQ,EAAE,IAAI;;WAEf,CAAA;;AAED,cAAI,MAAM,GAAG;;AAEX,eAAG,EAAE,MAAM;;AAEX,iBAAK,EAAE,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;;AAEvC,iBAAK,EAAE,KAAK,GAAG,MAAM;;WAEtB,CAAA;;AAED,iBAAO,UAAU,CACN,GAAG,CAAC,MAAM,CAAC,CACX,IAAI,CAAC,UAAA,OAAO,EAAI;;AAEf,mBAAO,OAAO,CAAC,IAAI,CAAC,OAAO,CAAA;WAE5B,CAAC,CAAC,OAAO,CAAC,CAAC,UAAA,GAAG,EAAI;;AAEjB,sBAAU,CAAC,cAAc,CAAC,GAAG,CAAC,CAAA;WAE/B,CAAC,CAAA;SACb,CAAA;OAEF;AACD,UAAI,EAAE,cAAU,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE;;;OAGtC;KACF,CAAC;GACH;CACF,CAAA,EAAE,CAAE","file":"productos/productos-form-directive.js","sourcesContent":["(function () {\n  'use strict';\n\n  /**\n   * @ngdoc directive\n   * @name productos.directive:productosForm\n   * @restrict EA\n   * @element\n   *\n   * @description\n   *\n   * @example\n     <example module=\"productos\">\n       <file name=\"index.html\">\n        <productos-form></productos-form>\n       </file>\n     </example>\n   *\n   */\n  angular\n    .module('productos')\n    .directive('productosForm', productosForm);\n\n  function productosForm() {\n    return {\n      restrict: 'EA',\n      scope: {\n        data: '@'\n      },\n      templateUrl: 'productos/productos-form-directive.tpl.html',\n      replace: false,\n      controllerAs: 'productosForm',\n      controller: function ($scope, $rootScope, AppService, $filter) {\n        \n        var self = this;\n\n        this.data = JSON.parse($scope.data) || { }\n\n        this.data.tempDescuentos = {}\n\n        this.data.bodega = 1;\n\n        if (this.data.descuentos && this.data.descuentos.length) \n          for(var i = 0, length1 = self.data.descuentos.length; i < length1; i++)\n            self.data.tempDescuentos['id_'+self.data.descuentos[i].categoriacliente] = self.data.descuentos[i].descuento\n\n        else this.data.descuentos = []\n\n\n        this.getCategoriasCliente = () => {\n\n          let config = {\n            method: 'GET',\n            url: AppService.setPrefix('categoriacliente?requireDiscount=1')\n          }\n\n          AppService\n            .http(config)\n            .then(success => {\n\n                self.categoriascliente = success.data.results\n\n            })\n\n        }\n\n        this.getCategoriasCliente()\n\n        this.validations = [\n          {\n            key: 'categoria',\n            required: true,\n            title: 'CategorÃ­a'\n          },\n          {\n            key: 'marca',\n            required: true,\n            title: 'Marca'\n          },\n          {\n            key: 'unidad_de_medida',\n            required: true,\n            title: 'Unidad de medida'\n          },\n          {\n            key: 'proveedor',\n            required: true,\n            title: 'Proveedor'\n          },\n          {\n            key: 'proveedor2',\n            required: false,\n            title: 'Proveedor 2'\n          },\n        ]\n\n        if ( Object.keys(self.data).length > 0 ){\n\n          for (var i = 0; i < self.validations.length; i++){\n\n            self.data['temp' + self.validations[i].key ] = self.data[self.validations[i].key]\n\n            if (self.data[self.validations[i].key])\n              self.data[self.validations[i].key] = self.data[self.validations[i].key].id\n\n\n          }\n        }\n\n        this.source = 'productos'\n\n        this.discountChange = (item, value) => {\n          \n          var found = $filter('filter')(self.data.descuentos, { categoriacliente: item.id })[0]\n\n\n          if(found)\n            self.data.descuentos[self.data.descuentos.indexOf(found)].descuento = value\n\n          else\n            self.data.descuentos.push({\n              descuento: value,\n              categoriacliente: item.id\n            })\n\n        }\n\n        this.save = () => {\n\n          var data = self.data,\n              url = self.source\n\n          for (var i = 0; i < self.validations.length; i++){\n\n            if ( !self.data[ 'temp' + self.validations[i].key ] && self.validations[i].required ){\n\n                self.validation = self.validations[i].title\n\n                return\n            }\n            else\n              self.validation = false\n            \n\n          }\n          \n          AppService\n            .save(data, url)\n            .then(success => {\n              \n\n              if (self.data.id){\n\n                 AppService.http({\n                  method:'PUT',\n                  data: {\n                    descuentos: self.data.descuentos\n                  },\n                  url: AppService.setPrefix('productos/modificar/descuentos')\n                }).then(thesuccess => {\n\n                  success.data.descuentos = thesuccess.data\n\n                  self.afterSave(success)\n\n                })\n\n              }\n              else{\n\n                AppService.http({\n                  method:'POST',\n                  data: {\n                    descuentos: self.data.descuentos,\n                    producto: success.data.id\n                  },\n                  url: AppService.setPrefix('productos/crear/descuentos')\n                }).then(thesuccess => {\n\n                  success.data.descuentos = thesuccess.data\n\n                  self.afterSave(success)\n\n\n                })\n\n              }\n                \n\n                \n\n            })\n            .catch(err => {\n\n              AppService.broadcastError(err)\n\n            })\n\n        }\n\n        this.afterSave = success => {\n\n          for (var i = 0; i < self.validations.length; i++)\n            self.data[ self.validations[i].key ] = self.data['temp' + self.validations[i].key]\n\n                self.data.id = success.data.id\n\n                AppService.broadcastDialog(self.data)\n\n                $rootScope.$broadcast('saved:' + self.source, self.data)\n\n        }\n\n        this.validateSelection = (field, item) => {\n\n          if (item)\n            \n            self.data[field] = item.id\n\n\n          else\n\n            return false\n\n        }\n\n        this.getAutocomplete = (text, field, source) => {\n          \n          var query = {}\n\n          query[field] = {\n\n            contains: text\n\n          }\n\n          var config = {\n\n            url: source,\n\n            query: 'where=' + JSON.stringify(query),\n\n            order: field + ' ASC'\n\n          }\n\n          return AppService\n                    .get(config)\n                    .then(success => {\n\n                      return success.data.results\n\n                    })['catch'](err => {\n\n                      AppService.broadcastError(err)\n\n                    })\n        }\n\n      },\n      link: function (scope, element, attrs) {\n        /* jshint unused:false */\n        /* eslint \"no-unused-vars\": [2, {\"args\": \"none\"}] */\n      }\n    };\n  }\n}());\n"],"sourceRoot":"/source/"}